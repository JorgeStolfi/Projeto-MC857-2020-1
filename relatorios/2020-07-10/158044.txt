Atividade do dia: [X] Buscar trechos > Ver : O Número de poltronas livres está errado.

Fui atrás do comando buscar trechos, a partir do qual fui entrando em chamadas de funções até que chegasse na que realmente contasse o número de poltronas disponíveis, até chegar em poltrona.lista_livres (comando_buscar_trechos -> html_resumo_de_trecho -> html_lista_de_trechos -> trecho.numero_de_poltronas_livres -> poltrona.lista_livres).

Então, analisei a tabela de testes de poltrona (poltrona.cria_testes) para ver a estrutura da tabela criada e como poltrona.lista_livres chamava objeto.busca_por_campos. Tentei trocar os atributos de busca por outras chaves e outros valores, debuggei as variaveis dentro das chamadas a objeto.busca_por_campos e deduzi que o problema deveria ser o fato de um dos valores de busca ser "None".

Então, analisei dentro de base_sql.executa_comando_SELECT como estava a query feita e dentro do mesmo módulo busquei todo a tabela de poltronas ('SELECT * FROM poltronas'). Depois de ver como era montada e query e com uma pesquisa para queries por "NULL" em SQL, descobri que esta estava sendo feita errada. Deveria ser feita com "IS NULL", não "= NULL".

Exemplo:
- Como estava sendo montada:
    SELECT indice FROM poltronas WHERE id_trecho = 'T-00000001' AND id_compra = NULL
- Como deveria ser:
    SELECT indice FROM poltronas WHERE id_trecho = 'T-00000001' AND id_compra IS NULL

Então, em tabela_generica.busca_por_campos, que é quem monta as condições da query, adicionei um tratamento específico para variaveis com None, de modo a definir um comparador como "IS" se for None, e como '=' se não for.

Analisando os testes do resumo de trecho e acessando a página de ofertas pelo servidor, o problema foi corrigido.